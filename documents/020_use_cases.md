# ユースケース定義書 (Use Case Specification)

本文書は、プラグイン郡が提供する各機能の典型的なユーザー操作シナリオ（ユースケース）を定義する。UI設計の上流工程として、期待される挙動とインタラクションの詳細は以下の通り。

##  前提条件
本文書では、以下のような環境での操作を想定する。ただし以下の環境は一例であり、実際には異なる場合がある。

### コレクション
顧客情報のコレクションには、以下のフィールドが定義される。
* 姓、名、姓（かな）、名（かな）、姓（正式）、名（正式）、氏名（検索用）、性別、続柄、国名、郵便番号、都道府県、郡、市区町村、大字・町名、番地、建物等、地区、電話番号、携帯電話番号、FAX、メールアドレス、生年月日、備考

### 入力フォーム
*   顧客情報入力フォームには、コレクションのフィールドと同様の入力フィールドが配置される。
*   ただし、氏名（検索用）は隠しフィールドであり、ユーザによる編集はなされない。
*   生年月日フィールドと連動する、「生年号」「生年（和暦）」「生月（和暦）」「生日（和暦）」の各フィールドを配置する。これらの値はコレクションには保存されず、生年月日の入力補助に用いられる。
*   その他、フォーム上に仮の値を保持するためのフィールドを配置することも考慮される。

##  氏名の入力

### 姓と名の入力

#### 姓の入力
*   ユーザが姓フィールドに「わたなべ」と入力しようと、「わた」までキー入力する。
*   キーシーケンスにより、顧客コレクションの「姓（かな）」フィールドが「わた*」で検索され、「渡辺・渡邉・渡邊」のように候補リストが表示される。（キーシーケンスは保持される）
*   ユーザが候補リストから「渡辺」を選択する。
*   姓フィールドに「渡辺」が設定される。
*   姓（正式）フィールドに「渡辺」が、氏名（検索用）フィールドに「渡辺」が自動的に設定される。
*   候補リストから選択があった（姓の入力の途中であった）ので、姓（かな）のフィールドには、読み方検索WebAPIのレスポンスから取得した「わたなべ」が設定される。

#### 名の入力
*   ユーザが名フィールドに「きえ」と入力する。
*   キーシーケンスにより、顧客コレクションの「名（かな）」フィールドが「きえ*」で検索され、「喜え・季恵・希恵」のように候補リストが表示される。（キーシーケンスは保持される）
*   ユーザが「喜え」で漢字入力を確定させ、Tabキーでフォーカスを移動する。
*   名フィールドに「喜え」が設定される。
*   名（正式）フィールドに「喜え」が、氏名（検索用）フィールドに「渡辺喜え」が自動的に設定される。
*   ユーザが名の入力を確定させたので、名（かな）のフィールドには、キーシーケンスから取得した「きえ」が設定される。

### よみがなの入力
*   ユーザが姓（かな）フィールドにフォーカスを移すと、読み方検索WebAPIが呼び出され、候補リストが表示される。姓フィールドの入力時のキーシーケンスによるかなも、この候補リストに含まれる。

*   ユーザが候補リストから姓のよみがなを選択する。あるいはフィールドを直接編集する。

*   姓（かな）フィールドにカタカナがあれば、ひらがなに変換される。

*   名（かな）フィールドも、同様に更新される。

### 正式な姓と名の入力

#### 正式な姓の入力
*   ユーザーが姓（正式）フィールドの「辺」をクリックしキャレットを置く。その下に「邊・邉・…」のように、異体字候補リストが表示される。
*   ユーザーが異体字候補リストから「邊」（IVS付き）を選択する。
*   姓（正式）フィールドに「渡」＋「邊」（IVS付き）が設定される。
*   姓フィールドの値が「渡辺」から「渡邊」（IVSなし）に更新される。
*   氏名（検索用）フィールドに「渡辺喜え」が自動的に設定される。(値に変化無し)

#### 正式な名の入力
*   ユーザーが名（正式）フィールドの「え」をクリックしキャレットを置く。その下に「え」のくずし字の候補リストが表示される。
*   ユーザーが異体字候補リストから「え」（IVS付き）を選択する。
*   名（正式）フィールドに「喜」＋「え」（IVS付き）が設定される。
*   名フィールドの値が「喜え」から「喜え」（IVSなし）に更新される。(値に変化無し)
*   氏名（検索用）フィールドに「渡辺喜え」が自動的に設定される。(値に変化無し)

### 氏名（検索用）を利用した検索
*   別のユーザーが、検索画面にて「渡辺」というキーワードで氏名検索を行う。
*   検索処理において、検索対象フィールドとして「氏名（検索用）」が利用される。
*   DB上には「氏名（正式）」が「渡邊喜え」（邊はIVS付き異体字）のレコードが存在するが、そのレコードの「氏名（検索用）」は「渡辺喜え」として正規化されているため、ヒットする。

## 性別の入力
*   ユーザーが性別フィールドにフォーカスを移す。
*   ドロップダウンリストが表示される。
*   ユーザーが性別候補リストから「女」を選択する。
*   性別フィールドに「女」が設定される。

## 続柄の入力
*   直前に入力された顧客０の続柄を保持しており、これをここでは「父」とする。
*   ユーザーが続柄フィールドにフォーカスを移す。
*   顧客０の続柄と、性別フィールドの値より、「長女・次女・三女・…」のような入力候補リストが表示される。
*   ユーザーが続柄候補リストから「長女」を選択する。
*   続柄フィールドに「長女」が設定される。
*   補足：顧客０の続柄がない場合は、性別フィールドの値より「妻・母・祖母・長女・…」のような候補リストになる。

## 住所の入力

### 郵便番号と住所の入力
*  ユーザが「郵便番号」フィールドに`３９１００１３`と入力する。
*  入力完了時に、`391-0013`に修正される。
*  住所検索WebAPIが呼び出され、各フィールドに値が自動入力される。
    *   都道府県：長野県
    *   郡：（空白）
    *   市区町村：茅野市
    *   大字・町名：宮川

### 郵便番号を入力しない場合の住所の入力
*   ユーザが都道府県フィールドにフォーカスを移すと、都道府県の候補リストが表示される。
*   ユーザが「な」とキー入力すると、キーシーケンスより「な」が得られ、候補リストが、読み方が「な」で始まる候補（長野県・長崎県・…）に絞られる。
*   ユーザが都道府県の候補リストから「長野県」を選択する。
*   都道府県フィールドに「長野県」が設定される。
*   ユーザが市区町村フィールドにフォーカスを移すと、地名マスタのコレクションが検索され「中野市・長野市・…」のように、市区町村の候補リストが表示される。
*   ユーザが「ち」とキー入力すると、キーシーケンスより「ち」が得られ、候補リストが、読み方が「ち」で始まる候補に絞られる。
*   ユーザが市区町村の候補リストから「茅野市」を選択する。
*   市区町村フィールドに「茅野市」が設定される。
*   ユーザが大字・町名フィールドにフォーカスを移すと、地名マスタのコレクションが検索され「泉野・北山・湖東・…」のように、大字・町名の候補リストが表示される。
*   ユーザが大字・町名の候補リストから「宮川」を選択する。
*   大字・町名フィールドに「宮川」が設定される。

### 番地以降の入力
*   ユーザが、番地フィールドに「２－３－４」と入力する。
*   フォーカスを外すと「2-3-4」に修正される。
*   建物等のフィールドも同様に、英数字は半角に修正される。

### 地区の入力
*   ユーザが地区フィールドにフォーカスを移すと、地名マスタのコレクションが検索され「新井・安国寺・…」のように、地区の候補リストが表示される。
*   ユーザが「ち」とキー入力すると、キーシーケンスより「ち」が得られ、候補リストが、読み方が「ち」で始まる候補に絞られる。
*   ユーザが地区の候補リストから「茅野」を選択する。
*   地区フィールドに「茅野」が設定される。

## 電話番号、携帯電話番号、FAX、メールアドレスの入力

### 電話番号の入力
*   ユーザが電話番号のフィールドに「０２６６　７３　１２３４」と入力する。
*   入力完了時に「0266-73-1234」に修正される。
    *   全角は半角に修正される。英数時以外は削除される。
    *   区切り文字（スペース、かっこ等）は「-」に修正される。
    *   ハイフンがない場合は、自動的にハイフンが挿入される。

### 携帯電話番号の入力
*   ユーザが携帯電話番号のフィールドに「08012345678」と入力する。
*   入力完了時に「080-1234-5678」に修正される。
    *   電話番号と同様

### FAXの入力
*   同様

### メールアドレスの入力
*   電話番号と同様、全角→半角の変換が行われる。
*   メールアドレスの書式かどうかのバリデーションが行われる

## 生年月日の入力
*   ユーザが生年号のフィールドにて「昭和」を選択し、入力する。
*   ユーザが生年（和暦）のフィールドにて「5」を入力する。
*   生年月日のフィールドに「1930/1/1」が設定される。
    * 生月（和暦）と生日（和暦）が未入力の場合は1とみなす。
*   ユーザが生月（和暦）のフィールドにて「5」を入力する。
*   生年月日のフィールドに「1930/5/1」が設定される。
*   ユーザが生日（和暦）のフィールドにて「6」を入力する。
*   生年月日のフィールドに「1930/5/6」が設定される。

### 生年月日の修正
*   ユーザが生年月日のフィールドを「1995/6/10」に更新する。
*   生年号のフィールドが「平成」に、生年（和暦）のフィールドが「7」に、生月（和暦）のフィールドが「6」に、生日（和暦）のフィールドが「10」に更新される。
