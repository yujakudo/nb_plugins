/**
 * This file is part of the NocoBase (R) project.
 * Copyright (c) 2020-2024 NocoBase Co., Ltd.
 * Authors: NocoBase Team.
 *
 * This project is dual-licensed under AGPL-3.0 and NocoBase Commercial License.
 * For more information, please refer to: https://www.nocobase.com/agreement.
 */

!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("@formily/core"),require("@formily/react"),require("@formily/shared"),require("@nocobase/client"),require("antd")):"function"==typeof define&&define.amd?define("@yujakudo/plugin-api-proxy",["react","@formily/core","@formily/react","@formily/shared","@nocobase/client","antd"],t):"object"==typeof exports?exports["@yujakudo/plugin-api-proxy"]=t(require("react"),require("@formily/core"),require("@formily/react"),require("@formily/shared"),require("@nocobase/client"),require("antd")):e["@yujakudo/plugin-api-proxy"]=t(e.react,e["@formily/core"],e["@formily/react"],e["@formily/shared"],e["@nocobase/client"],e.antd)}(self,function(e,t,n,o,r,i){return function(){"use strict";var l={563:function(e){e.exports=t},505:function(e){e.exports=n},875:function(e){e.exports=o},772:function(e){e.exports=r},721:function(e){e.exports=i},156:function(t){t.exports=e}},a={};function c(e){var t=a[e];if(void 0!==t)return t.exports;var n=a[e]={exports:{}};return l[e](n,n.exports,c),n.exports}c.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return c.d(t,{a:t}),t},c.d=function(e,t){for(var n in t)c.o(t,n)&&!c.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var u={};return!function(){c.r(u),c.d(u,{default:function(){return P}});var e=c(772),t=JSON.parse('{"u2":"@yujakudo/plugin-api-proxy"}'),n=c(156),o=c.n(n),r=[{label:'{{t("なし")}}',value:"none"},{label:'{{t("日ごと")}}',value:"daily"},{label:'{{t("週ごと")}}',value:"weekly"},{label:'{{t("月ごと")}}',value:"monthly"},{label:'{{t("年ごと")}}',value:"yearly"}],i={name:"api_proxy_apis",filterTargetKey:"id",fields:[{type:"string",name:"name",interface:"input",uiSchema:{title:'{{t("名前")}}',required:!0,"x-component":"Input"}},{type:"string",name:"url",interface:"input",uiSchema:{title:'{{t("URL")}}',required:!0,"x-component":"Input.URL"}},{type:"text",name:"description",interface:"textarea",uiSchema:{title:'{{t("説明")}}',"x-component":"Input.TextArea"}},{type:"json",name:"headers",interface:"json",uiSchema:{title:'{{t("ヘッダ")}}',"x-component":"Input.JSON"}},{type:"string",name:"limit",interface:"select",uiSchema:{title:'{{t("利用制限")}}',enum:r,default:"none","x-component":"Select"}},{type:"integer",name:"maxRequests",interface:"number",uiSchema:{title:'{{t("最大利用回数")}}',"x-component":"Input",default:0}},{type:"integer",name:"limitStartWeekday",interface:"select",uiSchema:{title:'{{t("開始曜日")}}',enum:[{label:'{{t("日")}}',value:0},{label:'{{t("月")}}',value:1},{label:'{{t("火")}}',value:2},{label:'{{t("水")}}',value:3},{label:'{{t("木")}}',value:4},{label:'{{t("金")}}',value:5},{label:'{{t("土")}}',value:6}],default:0,"x-component":"Select"}},{type:"integer",name:"limitStartMonth",interface:"number",uiSchema:{title:'{{t("開始月")}}',"x-component":"Input",minimum:1,maximum:12}},{type:"integer",name:"limitStartDay",interface:"number",uiSchema:{title:'{{t("開始日")}}',"x-component":"Input",minimum:1,maximum:31}},{type:"time",name:"limitStartTime",interface:"time",uiSchema:{title:'{{t("開始時刻")}}',"x-component":"TimePicker"}},{type:"integer",name:"currentAccessCount",interface:"number",uiSchema:{title:'{{t("現在の利用回数")}}',"x-component":"Input",default:0,readOnly:!0}},{name:"timezone",interface:"select",uiSchema:{type:"string",title:'{{t("タイムゾーン")}}',"x-component":"Select","x-decorator":"FormItem",enum:[{label:"UTC",value:"UTC"},{label:"Asia/Tokyo",value:"Asia/Tokyo"},{label:"America/New_York",value:"America/New_York"},{label:"Europe/London",value:"Europe/London"}],default:"UTC"}},{type:"date",name:"lastAccessAt",interface:"datetime",uiSchema:{title:'{{t("最終アクセス時刻")}}',"x-component":"DatePicker","x-component-props":{showTime:!0},readOnly:!0}},{type:"date",name:"nextResetAt",interface:"datetime",uiSchema:{title:'{{t("次のカウントリセット時刻")}}',"x-component":"DatePicker","x-component-props":{showTime:!0},readOnly:!0}}]},l=c(721),a=c(563),p=c(505);function s(e,t,n,o,r,i,l){try{var a=e[i](l),c=a.value}catch(e){n(e);return}a.done?t(c):Promise.resolve(c).then(o,r)}function m(e){return function(){var t=this,n=arguments;return new Promise(function(o,r){var i=e.apply(t,n);function l(e){s(i,o,r,l,a,"next",e)}function a(e){s(i,o,r,l,a,"throw",e)}l(void 0)})}}function f(e,t){var n,o,r,i,l={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){var c=[i,a];if(n)throw TypeError("Generator is already executing.");for(;l;)try{if(n=1,o&&(r=2&c[0]?o.return:c[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,c[1])).done)return r;switch(o=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return l.label++,{value:c[1],done:!1};case 5:l.label++,o=c[1],c=[0];continue;case 7:c=l.ops.pop(),l.trys.pop();continue;default:if(!(r=(r=l.trys).length>0&&r[r.length-1])&&(6===c[0]||2===c[0])){l=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){l.label=c[1];break}if(6===c[0]&&l.label<r[1]){l.label=r[1],r=c;break}if(r&&l.label<r[2]){l.label=r[2],l.ops.push(c);break}r[2]&&l.ops.pop(),l.trys.pop();continue}c=t.call(e,l)}catch(e){c=[6,e],o=0}finally{n=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}var d=function(){var t=(0,e.useActionContext)().setVisible,n=l.App.useApp().message,o=(0,p.useForm)(),r=(0,e.useDataBlockResource)(),i=(0,e.useDataBlockRequest)().runAsync,a=(0,e.useCollection)();return{type:"primary",onClick:function(){return m(function(){var e;return f(this,function(l){switch(l.label){case 0:return[4,o.submit()];case 1:if(l.sent(),!(e=o.values)[a.filterTargetKey])return[3,3];return[4,r.update({values:e,filterByTk:e[a.filterTargetKey]})];case 2:return l.sent(),[3,5];case 3:return[4,r.create({values:e})];case 4:l.sent(),l.label=5;case 5:return[4,i()];case 6:return l.sent(),n.success('{{t("保存しました")}}'),t(!1),[2]}})})()}}},y=function(){var t=(0,e.useCollectionRecordData)();return{form:(0,n.useMemo)(function(){return(0,a.createForm)({initialValues:t})},[])}},x=function(){var t=l.App.useApp().message,n=(0,e.useCollectionRecordData)(),o=(0,e.useDataBlockResource)(),r=(0,e.useDataBlockRequest)().runAsync,i=(0,e.useCollection)();return{confirm:{title:'{{t("削除")}}',content:'{{t("本当に削除してもよろしいですか？")}}'},onClick:function(){return m(function(){return f(this,function(e){switch(e.label){case 0:return[4,o.destroy({filterByTk:n[i.filterTargetKey]})];case 1:return e.sent(),[4,r()];case 2:return e.sent(),t.success('{{t("削除しました")}}'),[2]}})})()}}},b=c(875),v={drawer:{type:"void","x-component":"Action.Drawer",title:'{{t("新規追加")}}',properties:{form:{type:"void","x-component":"FormV2",properties:{tabs:{type:"void","x-component":"Tabs","x-component-props":{},properties:{tab1:{type:"void",title:'{{t("基本設定")}}',"x-component":"Tabs.TabPane",properties:{name:{"x-decorator":"FormItem","x-component":"CollectionField"},url:{"x-decorator":"FormItem","x-component":"CollectionField"},headers:{"x-decorator":"FormItem","x-component":"CollectionField"},description:{"x-decorator":"FormItem","x-component":"CollectionField"}}},tab2:{type:"void",title:'{{t("利用制限設定")}}',"x-component":"Tabs.TabPane",properties:{limit:{"x-decorator":"FormItem","x-component":"CollectionField"},maxRequests:{"x-decorator":"FormItem","x-component":"CollectionField","x-reactions":{dependencies:["limit"],fulfill:{state:{visible:'{{$deps[0] !== "none"}}'}}}},limitStartWeekday:{"x-decorator":"FormItem","x-component":"CollectionField","x-reactions":{dependencies:["limit"],fulfill:{state:{visible:'{{$deps[0] === "weekly"}}'}}}},limitStartMonth:{"x-decorator":"FormItem","x-component":"CollectionField","x-reactions":{dependencies:["limit"],fulfill:{state:{visible:'{{$deps[0] === "yearly"}}'}}}},limitStartDay:{"x-decorator":"FormItem","x-component":"CollectionField","x-reactions":{dependencies:["limit"],fulfill:{state:{visible:'{{$deps[0] === "monthly" || $deps[0] === "yearly"}}'}}}},limitStartTime:{"x-decorator":"FormItem","x-component":"CollectionField","x-reactions":{dependencies:["limit"],fulfill:{state:{visible:'{{$deps[0] !== "none"}}'}}}},currentAccessCount:{"x-decorator":"FormItem","x-component":"CollectionField","x-reactions":{dependencies:["limit"],fulfill:{state:{visible:'{{$deps[0] !== "none"}}'}}}},timezone:{"x-decorator":"FormItem","x-component":"CollectionField","x-reactions":{dependencies:["limit"],fulfill:{state:{visible:'{{$deps[0] !== "none"}}'}}}}}}}},footer:{type:"void","x-component":"Action.Drawer.Footer",properties:{submit:{title:'{{t("送信")}}',"x-component":"Action","x-use-component-props":"useSubmitActionProps"}}}}}}}},h=JSON.parse(JSON.stringify(v));h.drawer.title='{{t("編集")}}',h.drawer.properties.form["x-use-component-props"]="useEditFormProps";var g={type:"void",name:(0,b.uid)(),"x-decorator":"TableBlockProvider","x-decorator-props":{collection:i.name,action:"list",showIndex:!0,dragSort:!1},properties:{actions:{type:"void","x-component":"ActionBar","x-component-props":{style:{marginBottom:20}},properties:{add:{type:"void","x-component":"Action",title:'{{t("新規追加")}}',"x-align":"right","x-component-props":{type:"primary"},properties:v}}},table:{type:"array","x-component":"TableV2","x-use-component-props":"useTableBlockProps","x-component-props":{rowKey:"id"},properties:{column1:{type:"void",title:'{{t("名前")}}',"x-component":"TableV2.Column",properties:{name:{type:"string","x-component":"CollectionField","x-pattern":"readPretty"}}},column2:{type:"void",title:'{{t("URL")}}',"x-component":"TableV2.Column",properties:{url:{type:"string","x-component":"CollectionField","x-pattern":"readPretty"}}},column3:{type:"void",title:'{{t("説明")}}',"x-component":"TableV2.Column","x-component-props":{width:200,ellipsis:!0},properties:{description:{type:"string","x-component":"CollectionField","x-pattern":"readPretty","x-component-props":{ellipsis:!0}}}},column4:{type:"void",title:'{{t("利用制限")}}',"x-component":"TableV2.Column",properties:{limit:{type:"string","x-component":"CollectionField","x-pattern":"readPretty","x-component-props":{enum:r}}}},column5:{type:"void",title:'{{t("最大利用回数")}}',"x-component":"TableV2.Column",properties:{maxRequests:{type:"number","x-component":"CollectionField","x-pattern":"readPretty"}}},column6:{type:"void",title:'{{t("現在の利用回数")}}',"x-component":"TableV2.Column",properties:{currentAccessCount:{type:"number","x-component":"CollectionField","x-pattern":"readPretty"}}},column7:{type:"void",title:'{{t("最終アクセス時刻")}}',"x-component":"TableV2.Column",properties:{lastAccessAt:{type:"string","x-component":"CollectionField","x-pattern":"readPretty"}}},actions:{type:"void",title:"Actions","x-component":"TableV2.Column",properties:{actions:{type:"void","x-component":"Space","x-component-props":{split:"|"},properties:{edit:{type:"void",title:'{{("編集")}}',"x-component":"Action.Link","x-component-props":{openMode:"drawer",icon:"EditOutlined"},properties:h},delete:{type:"void",title:'{{t("削除")}}',"x-component":"Action.Link","x-use-component-props":"useDeleteActionProps"}}}}}}}}};function S(e,t,n,o,r,i,l){try{var a=e[i](l),c=a.value}catch(e){n(e);return}a.done?t(c):Promise.resolve(c).then(o,r)}function C(e,t,n){return(C=k()?Reflect.construct:function(e,t,n){var o=[null];o.push.apply(o,t);var r=new(Function.bind.apply(e,o));return n&&F(r,n.prototype),r}).apply(null,arguments)}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function F(e,t){return(F=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function T(e){var t="function"==typeof Map?new Map:void 0;return(T=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return C(e,arguments,w(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),F(n,e)})(e)}function k(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(k=function(){return!!e})()}var P=function(n){var r;if("function"!=typeof n&&null!==n)throw TypeError("Super expression must either be null or a function");function l(){var e,t;if(!(this instanceof l))throw TypeError("Cannot call a class as a function");return e=l,t=arguments,e=w(e),function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,k()?Reflect.construct(e,t||[],w(this).constructor):e.apply(this,t))}return l.prototype=Object.create(n&&n.prototype,{constructor:{value:l,writable:!0,configurable:!0}}),n&&F(l,n),r=[{key:"load",value:function(){var n,r=this;return(n=function(){return function(e,t){var n,o,r,i,l={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){var c=[i,a];if(n)throw TypeError("Generator is already executing.");for(;l;)try{if(n=1,o&&(r=2&c[0]?o.return:c[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,c[1])).done)return r;switch(o=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return l.label++,{value:c[1],done:!1};case 5:l.label++,o=c[1],c=[0];continue;case 7:c=l.ops.pop(),l.trys.pop();continue;default:if(!(r=(r=l.trys).length>0&&r[r.length-1])&&(6===c[0]||2===c[0])){l=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){l.label=c[1];break}if(6===c[0]&&l.label<r[1]){l.label=r[1],r=c;break}if(r&&l.label<r[2]){l.label=r[2],l.ops.push(c);break}r[2]&&l.ops.pop(),l.trys.pop();continue}c=t.call(e,l)}catch(e){c=[6,e],o=0}finally{n=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(n){return r.app.pluginSettingsManager.add(t.u2,{title:'{{t("APIプロキシ")}}',icon:"ApiOutlined",Component:function(){return o().createElement(e.ExtendCollectionsProvider,{collections:[i]},o().createElement(e.SchemaComponent,{schema:g,scope:{useSubmitActionProps:d,useEditFormProps:y,useDeleteActionProps:x}}))}}),[2]})},function(){var e=this,t=arguments;return new Promise(function(o,r){var i=n.apply(e,t);function l(e){S(i,o,r,l,a,"next",e)}function a(e){S(i,o,r,l,a,"throw",e)}l(void 0)})})()}}],function(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}(l.prototype,r),l}(T(e.Plugin))}(),u}()});